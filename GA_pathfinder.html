<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="AG.js"></script>
    <script src="GA_functions.js"></script>
    <script src="auxiliar_functions.js"></script>
    <style>
      .button {
        min-width: 100px;
        min-height: 30px;
        background-color: #4CAF50;
        display: inline-block;
        font-size: 16px;
        height: 50px;
        width: 300px;
      }
    </style>
</head>
<body>
  <title>Path finder</title>
  <table style = "width:100%">
    <tr align="center">
      <th>
        <h1>Pathfinder</h1>
      </th>
    </tr>
    <tr>
      <th>
        <canvas id="canvas" width="300" height="300"></canvas>
        <script>


         window.onload= drawCanvas();
         function drawCanvas()
        {
            canv=document.getElementById("canvas");//get the canvas
            Context = canv.getContext("2d");//get the 2d context
            Context.fillStyle="black";
            Context.clearRect(0,0,canv.width,canv.height);
            Context.fillRect( 0 , 0 , canv.width , canv.height ); // crea el background
            var width = map[0].length;
            var height = map.length;
            var gridRect = {x: canv.width / width, y: canv.height/ height};
            for (var yindex = 0; yindex < height; yindex ++)
            {
              var row = map[yindex];
              for (var xindex = 0; xindex < width; xindex ++){
                var xPosition = xindex * gridRect.x;
                var yPosition = yindex * gridRect.y;
                switch (row[xindex]) {
                  case 'O':
                      Context.fillStyle = "lime";
                      Context.fillRect(xPosition,yPosition,gridRect.x,gridRect.y);
                    break;
                  case '_':
                      Context.fillStyle = "black";
                    break;
                  case 'E':
                      Context.fillStyle = "cyan";
                    break;
                  case 'X':
                      Context.fillStyle = "red";
                    break;
                  default:

                }
                Context.fillRect(xPosition,yPosition,gridRect.x,gridRect.y);
              }
            }
            imageData = Context.getImageData(0,0,canv.width,canv.height)
        }


        </script>
      </th>
    </tr>
    <tr align="center">
      <th>
        <button class="button" onclick="executeAlgorithm()"> Iniciar CÃ¡lculo </button>
      </th>
    </tr>
    <tr>
      <th>
        <button class="button" type="button" name="Limpiar" onclick="clear()"> limpiar</button>
      </th>
    </tr>
  </table>
    <script>
    function executeAlgorithm(){
        //in the function we pass the functions releated with our genetic algorithm
        //the numbers are crossover_rate,mutation_rate,population_size and chromosome_size
        //chromosome size is defined on the file GA_function.js
        var my_genetic_algorithm = newGA(f_selection,f_crossover,f_mutation,f_new_population,f_fitness,0.3,0.05,20,chromosome_size);
        //we initialize a global values for the fitness function
        //it let us to put every map what we want
        init_fitness('O','X','E');
        //this function evolves the population the number of generations we specify
        //return the last generation evolved
        var final_population = Evolve(my_genetic_algorithm,50);

        var bestIndividue = checkBestResult(final_population);
        var path = checkPathOfIndivue(bestIndividue);

        drawCanvas();
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");

        var width = map[0].length;
        var height = map.length;
        var gridRect = {x: canv.width / width, y: canv.height/ height};

        context.moveTo(gridRect.x / 2, gridRect.y / 2);
        var lastXPosition = gridRect.x / 2
        var lastYPosition = gridRect.y / 2

        path.forEach(function(step) {
          switch (step) {
            case rgt:
              lastXPosition += gridRect.x
              break;
            case up_:
              lastYPosition -= gridRect.y
              break;
            case dwn:
              lastYPosition += gridRect.y
              break;
            case lft:
              lastXPosition -= gridRect.x
              break;
            default:
          }
          context.lineTo(lastXPosition,lastYPosition);
        });

        context.lineWidth = 5;
        context.strokeStyle = '#ff0000';
        context.stroke();
      }
      function clear(){
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");
        context.clearRect(0,0,canvas.width.canvas.height);
      }
    </script>

</body>
</html>
